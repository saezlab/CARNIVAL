file.copy(from = "results_cplex.txt",to = paste(current_dir,"/results/",dir_name,"/results_cplex.txt",sep=""))
file.remove("results_cplex.txt")
setwd(current_dir)
# Write result files
ptm <- proc.time()
if (file.exists(paste("results/",dir_name,"/results_cplex.txt",sep=""))) {
for(i in 1:length(variables)){
sif <- readOutResult(cplexSolutionFileName = paste("results/",dir_name,"/results_cplex.txt",sep=""), variables = variables, pknList = pknList, conditionIDX = i,dir_name = dir_name, Export_all = Export_all,inputs=inputs,measurements=measurements)
}
} else {
print("No result to be written")
}
Elapsed_3 <- proc.time() - ptm
# Logged computational time
ElapsedAll <- as.data.frame(matrix(t(c(Elapsed_1[3],Elapsed_2[3],Elapsed_3[3])),3,1))
rownames(ElapsedAll) <- c("WriteConstraints:","CplexSolving:","ExportResults:")
write.table(x = ElapsedAll,file = paste("results/",dir_name,"/elapsed_time.txt",sep=""),col.names = F,row.names = T,quote = F)
}
}
# --- End of script --- #
# [Debug/QC mode] Print variable names
# variables$Condition_1$exp
# --- End of debugging part --- #
counter_compound=30
print("")
print("=========================================")
print(paste0("Optimising compound Nr ", toString(counter_compound),"/",toString(length(Compounds))," : " ,Compounds[counter_compound]," - Using network: ",ScaffoldName[ScaffoldNet[counter_network]]))
print("=========================================")
print("")
Network <- ScaffoldNet[counter_network]
NetName <- ScaffoldName[ScaffoldNet[counter_network]]
Result_dir <- paste0(Compounds[counter_compound],"_",NetName) # specify a name for result directory; if NULL, then date and time will be used by default
library(readr)
library(tidyr)
library(XML)
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/"); source("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/CRILPR_Functions.R")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
current_dir <- getwd()
dir.create("results",showWarnings = FALSE)
setwd(paste(current_dir,"/results",sep=""))
if (is.null(Result_dir)) {
dir_name <- paste("results_",Sys.time(),sep="")
} else {
if (InputType==1) {
dir_name <- paste0("validation_",Result_dir)
} else if (InputType==2) {
dir_name <- paste0("validation_",Result_dir,"_MainTarget")
}
}
dir.create(dir_name); setwd(current_dir)
if (Network==1) {
network      <- read.table("resources/OmniPathSIF_NoHyphen.tsv", sep = "\t", header = FALSE)
} else if (Network==2) {
network      <- read.table("resources/Network_Generic_FIN_RemovedTFGenes_NoHyphen.sif", sep = "\t", header = FALSE)
} else if (Network==3) {
network      <- read.delim("resources/SignorSIF_NoHyphenNoSlashNoColonNoSpace.tsv", sep = "\t", header = FALSE)
} else {
stop("Please choose the provided model scaffolds")
}
if (InputType==1) {
inputs       <- try(read.table(paste0("inputs/Inputs_Main_",Compounds[counter_compound],".tsv"), sep="\t", header = TRUE))
if(inherits(inputs, "try-error")) next
} else if (InputType==2) {
# inputs       <- try(read.table(paste0("inputs/Inputs_Main_STITCH_",Compounds[counter_compound],".tsv"), sep="\t", header = TRUE))
if(inherits(inputs, "try-error")) next
}
measurements <- try(read.table(paste0("measurements/DRT_MeanSDCutOff_2_PGN_MeanSDCutOff_2/Meas_DRT_PGN_",Compounds[counter_compound],".tsv"), sep="\t", header=TRUE))
View(inputs)
View(measurements)
if(inherits(measurements, "try-error")) next
data <- measurements
pknList <- as.data.frame(network)
colnames(pknList) <- c("Node1", "Sign", "Node2")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/") # temporary shift to src directory
print("Writing constraints...")
ptm <- proc.time()
variables <- writeLPFile(data,pknList,inputs,0.1)
function (x, value)
# ---------------------- #
# CARNIVAL driver script #
# ---------------------- #
# Integrated pipeline for validation dataset (E-MTAB-2091)
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
rm(list=ls()) # clear environment
cat("\014") # clear screen
Compounds <- t(read.table(file = "resources/All_Compound_Names.tsv",sep = "\r"))
# ScaffoldNet <- c(1,2,3) # c(1,2,3,4) # Model2 [Signor] has an issue with writeSIF and Model3 [Babur] is too large to write constraints
ScaffoldNet <- 3 # c(1,2,3,4) # Model2 [Signor] has an issue with writeSIF and Model3 [Babur] is too large to write constraints
ScaffoldName <- c("omnipath","generic","signor")
InputType <- 1 # [1,2] 1 = Direct targets plus PROGENy; 2 = Only Direct targets; 3 = Direct targets plus STRING
Export_all <- 0 # c(0,1) export all ILP variables or not; if 0, only cplex results, predicted node values and sif file will be written
# for (counter_compound in 1:length(Compounds)) {
for (counter_compound in 31:length(Compounds)) {
# for (counter_compound in 5:10) {
for (counter_network in 1:length(ScaffoldNet)) {
print("")
print("=========================================")
print(paste0("Optimising compound Nr ", toString(counter_compound),"/",toString(length(Compounds))," : " ,Compounds[counter_compound]," - Using network: ",ScaffoldName[ScaffoldNet[counter_network]]))
print("=========================================")
print("")
Network <- ScaffoldNet[counter_network]
NetName <- ScaffoldName[ScaffoldNet[counter_network]]
Result_dir <- paste0(Compounds[counter_compound],"_",NetName) # specify a name for result directory; if NULL, then date and time will be used by default
# ============================== #
# Load necessary packages and functions
library(readr)
library(tidyr)
library(XML)
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/"); source("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/CRILPR_Functions.R")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
# Create a directory to store results
current_dir <- getwd()
dir.create("results",showWarnings = FALSE)
setwd(paste(current_dir,"/results",sep=""))
if (is.null(Result_dir)) {
dir_name <- paste("results_",Sys.time(),sep="")
} else {
if (InputType==1) {
dir_name <- paste0("validation_",Result_dir)
} else if (InputType==2) {
dir_name <- paste0("validation_",Result_dir,"_MainTarget")
}
}
dir.create(dir_name); setwd(current_dir)
# Load ILP inputs
if (Network==1) {
network      <- read.table("resources/OmniPathSIF_NoHyphen.tsv", sep = "\t", header = FALSE)
} else if (Network==2) {
network      <- read.table("resources/Network_Generic_FIN_RemovedTFGenes_NoHyphen.sif", sep = "\t", header = FALSE)
} else if (Network==3) {
network      <- read.delim("resources/SignorSIF_NoHyphenNoSlashNoColonNoSpace.tsv", sep = "\t", header = FALSE)
} else {
stop("Please choose the provided model scaffolds")
}
if (InputType==1) {
inputs       <- try(read.table(paste0("inputs/Inputs_Main_",Compounds[counter_compound],".tsv"), sep="\t", header = TRUE))
if(inherits(inputs, "try-error")) next
} else if (InputType==2) {
# inputs       <- try(read.table(paste0("inputs/Inputs_Main_STITCH_",Compounds[counter_compound],".tsv"), sep="\t", header = TRUE))
if(inherits(inputs, "try-error")) next
}
# measurements <- try(read_delim(paste0("measurements/DRT_MeanSDCutOff_2_PGN_MeanSDCutOff_2/Meas_DRT_PGN_",Compounds[counter_compound],".tsv"), "\t", escape_double = FALSE, trim_ws = TRUE))
measurements <- try(read.table(paste0("measurements/DRT_MeanSDCutOff_2_PGN_MeanSDCutOff_2/Meas_DRT_PGN_",Compounds[counter_compound],".tsv"), sep="\t", header=TRUE))
if(inherits(measurements, "try-error")) next
# Input processing
data <- measurements
pknList <- as.data.frame(network)
colnames(pknList) <- c("Node1", "Sign", "Node2")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/") # temporary shift to src directory
# Write constraints as ILP inputs
print("Writing constraints...")
ptm <- proc.time()
variables <- writeLPFile(data,pknList,inputs,0.1)
Elapsed_1 <- proc.time() - ptm
# Solve ILP problem with cplex, remove temp files, and return to the main directory
ptm <- proc.time()
system(paste0(getwd(), "/cplex -f cplexCommand.txt"))
Elapsed_2 <- proc.time() - ptm
# file.remove("testFile.lp")
file.remove("cplex.log")
file.copy(from = "results_cplex.txt",to = paste(current_dir,"/results/",dir_name,"/results_cplex.txt",sep=""))
file.remove("results_cplex.txt")
setwd(current_dir)
# Write result files
ptm <- proc.time()
if (file.exists(paste("results/",dir_name,"/results_cplex.txt",sep=""))) {
for(i in 1:length(variables)){
sif <- readOutResult(cplexSolutionFileName = paste("results/",dir_name,"/results_cplex.txt",sep=""), variables = variables, pknList = pknList, conditionIDX = i,dir_name = dir_name, Export_all = Export_all,inputs=inputs,measurements=measurements)
}
} else {
print("No result to be written")
}
Elapsed_3 <- proc.time() - ptm
# Logged computational time
ElapsedAll <- as.data.frame(matrix(t(c(Elapsed_1[3],Elapsed_2[3],Elapsed_3[3])),3,1))
rownames(ElapsedAll) <- c("WriteConstraints:","CplexSolving:","ExportResults:")
write.table(x = ElapsedAll,file = paste("results/",dir_name,"/elapsed_time.txt",sep=""),col.names = F,row.names = T,quote = F)
}
}
# --- End of script --- #
# [Debug/QC mode] Print variable names
# variables$Condition_1$exp
# --- End of debugging part --- #
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
rm(list=ls()) # clear environment
cat("\014") # clear screen
Compounds <- t(read.table(file = "resources/All_Compound_Names.tsv",sep = "\r"))
ScaffoldNet <- 3 # c(1,2,3,4) # Model2 [Signor] has an issue with writeSIF and Model3 [Babur] is too large to write constraints
ScaffoldName <- c("omnipath","generic","signor")
InputType <- 1 # [1,2] 1 = Direct targets plus PROGENy; 2 = Only Direct targets; 3 = Direct targets plus STRING
Export_all <- 0 # c(0,1) export all ILP variables or not; if 0, only cplex results, predicted node values and sif file will be written
for (counter_compound in 31:length(Compounds)) {
# for (counter_compound in 5:10) {
for (counter_network in 1:length(ScaffoldNet)) {
print("")
print("=========================================")
print(paste0("Optimising compound Nr ", toString(counter_compound),"/",toString(length(Compounds))," : " ,Compounds[counter_compound]," - Using network: ",ScaffoldName[ScaffoldNet[counter_network]]))
print("=========================================")
print("")
Network <- ScaffoldNet[counter_network]
NetName <- ScaffoldName[ScaffoldNet[counter_network]]
Result_dir <- paste0(Compounds[counter_compound],"_",NetName) # specify a name for result directory; if NULL, then date and time will be used by default
# ============================== #
# Load necessary packages and functions
library(readr)
library(tidyr)
library(XML)
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/"); source("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/CRILPR_Functions.R")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
# Create a directory to store results
current_dir <- getwd()
dir.create("results",showWarnings = FALSE)
setwd(paste(current_dir,"/results",sep=""))
if (is.null(Result_dir)) {
dir_name <- paste("results_",Sys.time(),sep="")
} else {
if (InputType==1) {
dir_name <- paste0("validation_",Result_dir)
} else if (InputType==2) {
dir_name <- paste0("validation_",Result_dir,"_MainTarget")
}
}
dir.create(dir_name); setwd(current_dir)
# Load ILP inputs
if (Network==1) {
network      <- read.table("resources/OmniPathSIF_NoHyphen.tsv", sep = "\t", header = FALSE)
} else if (Network==2) {
network      <- read.table("resources/Network_Generic_FIN_RemovedTFGenes_NoHyphen.sif", sep = "\t", header = FALSE)
} else if (Network==3) {
network      <- read.delim("resources/SignorSIF_NoHyphenNoSlashNoColonNoSpace.tsv", sep = "\t", header = FALSE)
} else {
stop("Please choose the provided model scaffolds")
}
if (InputType==1) {
inputs       <- try(read.table(paste0("inputs/Inputs_Main_",Compounds[counter_compound],".tsv"), sep="\t", header = TRUE))
if(inherits(inputs, "try-error")) next
} else if (InputType==2) {
# inputs       <- try(read.table(paste0("inputs/Inputs_Main_STITCH_",Compounds[counter_compound],".tsv"), sep="\t", header = TRUE))
if(inherits(inputs, "try-error")) next
}
# measurements <- try(read_delim(paste0("measurements/DRT_MeanSDCutOff_2_PGN_MeanSDCutOff_2/Meas_DRT_PGN_",Compounds[counter_compound],".tsv"), "\t", escape_double = FALSE, trim_ws = TRUE))
measurements <- try(read.table(paste0("measurements/DRT_MeanSDCutOff_2_PGN_MeanSDCutOff_2/Meas_DRT_PGN_",Compounds[counter_compound],".tsv"), sep="\t", header=TRUE))
if(inherits(measurements, "try-error")) next
# Input processing
data <- measurements
pknList <- as.data.frame(network)
colnames(pknList) <- c("Node1", "Sign", "Node2")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/") # temporary shift to src directory
# Write constraints as ILP inputs
print("Writing constraints...")
ptm <- proc.time()
variables <- writeLPFile(data,pknList,inputs,0.1)
Elapsed_1 <- proc.time() - ptm
# Solve ILP problem with cplex, remove temp files, and return to the main directory
ptm <- proc.time()
system(paste0(getwd(), "/cplex -f cplexCommand.txt"))
Elapsed_2 <- proc.time() - ptm
# file.remove("testFile.lp")
file.remove("cplex.log")
file.copy(from = "results_cplex.txt",to = paste(current_dir,"/results/",dir_name,"/results_cplex.txt",sep=""))
file.remove("results_cplex.txt")
setwd(current_dir)
# Write result files
ptm <- proc.time()
if (file.exists(paste("results/",dir_name,"/results_cplex.txt",sep=""))) {
for(i in 1:length(variables)){
sif <- readOutResult(cplexSolutionFileName = paste("results/",dir_name,"/results_cplex.txt",sep=""), variables = variables, pknList = pknList, conditionIDX = i,dir_name = dir_name, Export_all = Export_all,inputs=inputs,measurements=measurements)
}
} else {
print("No result to be written")
}
Elapsed_3 <- proc.time() - ptm
# Logged computational time
ElapsedAll <- as.data.frame(matrix(t(c(Elapsed_1[3],Elapsed_2[3],Elapsed_3[3])),3,1))
rownames(ElapsedAll) <- c("WriteConstraints:","CplexSolving:","ExportResults:")
write.table(x = ElapsedAll,file = paste("results/",dir_name,"/elapsed_time.txt",sep=""),col.names = F,row.names = T,quote = F)
}
}
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
rm(list=ls()) # clear environment
cat("\014") # clear screen
Compounds <- t(read.table(file = "resources/All_Compound_Names.tsv",sep = "\r"))
ScaffoldNet <- 3 # c(1,2,3,4) # Model2 [Signor] has an issue with writeSIF and Model3 [Babur] is too large to write constraints
ScaffoldName <- c("omnipath","generic","signor")
InputType <- 1 # [1,2] 1 = Direct targets plus PROGENy; 2 = Only Direct targets; 3 = Direct targets plus STRING
Export_all <- 0 # c(0,1) export all ILP variables or not; if 0, only cplex results, predicted node values and sif file will be written
counter_compound
counter_compound <-1
counter_network=1
print("")
print("=========================================")
print(paste0("Optimising compound Nr ", toString(counter_compound),"/",toString(length(Compounds))," : " ,Compounds[counter_compound]," - Using network: ",ScaffoldName[ScaffoldNet[counter_network]]))
print("=========================================")
print("")
Network <- ScaffoldNet[counter_network]
NetName <- ScaffoldName[ScaffoldNet[counter_network]]
Result_dir <- paste0(Compounds[counter_compound],"_",NetName) # specify a name for result directory; if NULL, then date and time will be used by default
library(readr)
library(tidyr)
library(XML)
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/"); source("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/CRILPR_Functions.R")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
current_dir <- getwd()
dir.create("results",showWarnings = FALSE)
setwd(paste(current_dir,"/results",sep=""))
if (is.null(Result_dir)) {
dir_name <- paste("results_",Sys.time(),sep="")
} else {
if (InputType==1) {
dir_name <- paste0("validation_",Result_dir)
} else if (InputType==2) {
dir_name <- paste0("validation_",Result_dir,"_MainTarget")
}
}
dir.create(dir_name); setwd(current_dir)
if (Network==1) {
network      <- read.table("resources/OmniPathSIF_NoHyphen.tsv", sep = "\t", header = FALSE)
} else if (Network==2) {
network      <- read.table("resources/Network_Generic_FIN_RemovedTFGenes_NoHyphen.sif", sep = "\t", header = FALSE)
} else if (Network==3) {
network      <- read.delim("resources/SignorSIF_NoHyphenNoSlashNoColonNoSpace.tsv", sep = "\t", header = FALSE)
} else {
stop("Please choose the provided model scaffolds")
}
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
rm(list=ls()) # clear environment
cat("\014") # clear screen
Compounds <- t(read.table(file = "resources/All_Compound_Names.tsv",sep = "\r"))
ScaffoldNet <- 3 # c(1,2,3,4) # Model2 [Signor] has an issue with writeSIF and Model3 [Babur] is too large to write constraints
ScaffoldName <- c("omnipath","generic","signor")
InputType <- 1 # [1,2] 1 = Direct targets plus PROGENy; 2 = Only Direct targets; 3 = Direct targets plus STRING
Export_all <- 0 # c(0,1) export all ILP variables or not; if 0, only cplex results, predicted node values and sif file will be written
counter_compound=30
counter_network=1
print("")
print("=========================================")
print(paste0("Optimising compound Nr ", toString(counter_compound),"/",toString(length(Compounds))," : " ,Compounds[counter_compound]," - Using network: ",ScaffoldName[ScaffoldNet[counter_network]]))
print("=========================================")
print("")
Network <- ScaffoldNet[counter_network]
NetName <- ScaffoldName[ScaffoldNet[counter_network]]
Result_dir <- paste0(Compounds[counter_compound],"_",NetName) # specify a name for result directory; if NULL, then date and time will be used by default
library(readr)
library(tidyr)
library(XML)
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/"); source("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/CRILPR_Functions.R")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
current_dir <- getwd()
dir.create("results",showWarnings = FALSE)
setwd(paste(current_dir,"/results",sep=""))
if (is.null(Result_dir)) {
dir_name <- paste("results_",Sys.time(),sep="")
} else {
if (InputType==1) {
dir_name <- paste0("validation_",Result_dir)
} else if (InputType==2) {
dir_name <- paste0("validation_",Result_dir,"_MainTarget")
}
}
dir.create(dir_name); setwd(current_dir)
if (Network==1) {
network      <- read.table("resources/OmniPathSIF_NoHyphen.tsv", sep = "\t", header = FALSE)
} else if (Network==2) {
network      <- read.table("resources/Network_Generic_FIN_RemovedTFGenes_NoHyphen.sif", sep = "\t", header = FALSE)
} else if (Network==3) {
network      <- read.delim("resources/SignorSIF_NoHyphenNoSlashNoColonNoSpace.tsv", sep = "\t", header = FALSE)
} else {
stop("Please choose the provided model scaffolds")
}
if (InputType==1) {
inputs       <- try(read.table(paste0("inputs/Inputs_Main_",Compounds[counter_compound],".tsv"), sep="\t", header = TRUE))
if(inherits(inputs, "try-error")) next
} else if (InputType==2) {
# inputs       <- try(read.table(paste0("inputs/Inputs_Main_STITCH_",Compounds[counter_compound],".tsv"), sep="\t", header = TRUE))
if(inherits(inputs, "try-error")) next
}
measurements <- try(read.table(paste0("measurements/DRT_MeanSDCutOff_2_PGN_MeanSDCutOff_2/Meas_DRT_PGN_",Compounds[counter_compound],".tsv"), sep="\t", header=TRUE))
if(inherits(measurements, "try-error")) next
data <- measurements
pknList <- as.data.frame(network)
colnames(pknList) <- c("Node1", "Sign", "Node2")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/") # temporary shift to src directory
print("Writing constraints...")
ptm <- proc.time()
variables <- writeLPFile(data,pknList,inputs,0.1)
cutoff=0.1
dataMatrix <- buildDataMatrix(data = data, pknList = pknList, inputs = inputs, cutoff = 0.1)
colnames(pknList) <- c("X1", "X2", "X3")
allSpecies <- unique(c(as.character(pknList$X1), as.character(pknList$X3)))
if(ncol(inputs) > 0){
ts <- intersect(colnames(inputs), allSpecies)
}
ts
ds <- intersect(colnames(data), allSpecies)
ds
dn <- setdiff(allSpecies, ds)
dn
colnames(data)
colnames(pknList) <- c("X1", "X2", "X3")
allSpecies <- unique(c(as.character(pknList$X1), as.character(pknList$X3)))
colnames(data)
ds <- intersect(colnames(data), allSpecies)
ds
colnames(pknList) <- c("X1", "X2", "X3")
allSpecies <- unique(c(as.character(pknList$X1), as.character(pknList$X3)))
if(ncol(inputs) > 0){
ts <- intersect(colnames(inputs), allSpecies)
}
ts
ds
dn <- setdiff(allSpecies, ds)
dataMatrix <- matrix(0, nrow = nrow(data), ncol = length(allSpecies))
dnNames <- paste0("DN:", dn)
dsNames <- paste0("DS:", ds)
colnames(dataMatrix) <- c(dnNames, dsNames)
c(dnNames, dsNames)
colnames(dataMatrix)
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
rm(list=ls()) # clear environment
cat("\014") # clear screen
Compounds <- t(read.table(file = "resources/All_Compound_Names.tsv",sep = "\r"))
ScaffoldNet <- 3 # c(1,2,3,4) # Model2 [Signor] has an issue with writeSIF and Model3 [Babur] is too large to write constraints
ScaffoldName <- c("omnipath","generic","signor")
InputType <- 1 # [1,2] 1 = Direct targets plus PROGENy; 2 = Only Direct targets; 3 = Direct targets plus STRING
Export_all <- 0 # c(0,1) export all ILP variables or not; if 0, only cplex results, predicted node values and sif file will be written
for (counter_compound in 30:31) {
for (counter_network in 1:length(ScaffoldNet)) {
print("")
print("=========================================")
print(paste0("Optimising compound Nr ", toString(counter_compound),"/",toString(length(Compounds))," : " ,Compounds[counter_compound]," - Using network: ",ScaffoldName[ScaffoldNet[counter_network]]))
print("=========================================")
print("")
Network <- ScaffoldNet[counter_network]
NetName <- ScaffoldName[ScaffoldNet[counter_network]]
Result_dir <- paste0(Compounds[counter_compound],"_",NetName) # specify a name for result directory; if NULL, then date and time will be used by default
# ============================== #
# Load necessary packages and functions
library(readr)
library(tidyr)
library(XML)
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/"); source("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/CRILPR_Functions.R")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/archive/CARNIVAL_Validation/E-MTAB-2091/integrated_pipeline/")
# Create a directory to store results
current_dir <- getwd()
dir.create("results",showWarnings = FALSE)
setwd(paste(current_dir,"/results",sep=""))
if (is.null(Result_dir)) {
dir_name <- paste("results_",Sys.time(),sep="")
} else {
if (InputType==1) {
dir_name <- paste0("validation_",Result_dir)
} else if (InputType==2) {
dir_name <- paste0("validation_",Result_dir,"_MainTarget")
}
}
dir.create(dir_name); setwd(current_dir)
# Load ILP inputs
if (Network==1) {
network      <- read.table("resources/OmniPathSIF_NoHyphen.tsv", sep = "\t", header = FALSE)
} else if (Network==2) {
network      <- read.table("resources/Network_Generic_FIN_RemovedTFGenes_NoHyphen.sif", sep = "\t", header = FALSE)
} else if (Network==3) {
network      <- read.delim("resources/SignorSIF_NoHyphenNoSlashNoColonNoSpace.tsv", sep = "\t", header = FALSE)
} else {
stop("Please choose the provided model scaffolds")
}
if (InputType==1) {
inputs       <- try(read.table(paste0("inputs/Inputs_Main_",Compounds[counter_compound],".tsv"), sep="\t", header = TRUE))
if(inherits(inputs, "try-error")) next
} else if (InputType==2) {
# inputs       <- try(read.table(paste0("inputs/Inputs_Main_STITCH_",Compounds[counter_compound],".tsv"), sep="\t", header = TRUE))
if(inherits(inputs, "try-error")) next
}
# measurements <- try(read_delim(paste0("measurements/DRT_MeanSDCutOff_2_PGN_MeanSDCutOff_2/Meas_DRT_PGN_",Compounds[counter_compound],".tsv"), "\t", escape_double = FALSE, trim_ws = TRUE))
measurements <- try(read.table(paste0("measurements/DRT_MeanSDCutOff_2_PGN_MeanSDCutOff_2/Meas_DRT_PGN_",Compounds[counter_compound],".tsv"), sep="\t", header=TRUE))
if(inherits(measurements, "try-error")) next
# Input processing
data <- measurements
pknList <- as.data.frame(network)
colnames(pknList) <- c("Node1", "Sign", "Node2")
setwd("~/Desktop/RWTH_Aachen/GitHub/CARNIVAL/src/") # temporary shift to src directory
# Write constraints as ILP inputs
print("Writing constraints...")
ptm <- proc.time()
variables <- try(writeLPFile(data,pknList,inputs,0.1))
if(inherits(variables, "try-error")) next
Elapsed_1 <- proc.time() - ptm
# Solve ILP problem with cplex, remove temp files, and return to the main directory
ptm <- proc.time()
system(paste0(getwd(), "/cplex -f cplexCommand.txt"))
Elapsed_2 <- proc.time() - ptm
# file.remove("testFile.lp")
file.remove("cplex.log")
file.copy(from = "results_cplex.txt",to = paste(current_dir,"/results/",dir_name,"/results_cplex.txt",sep=""))
file.remove("results_cplex.txt")
setwd(current_dir)
# Write result files
ptm <- proc.time()
if (file.exists(paste("results/",dir_name,"/results_cplex.txt",sep=""))) {
for(i in 1:length(variables)){
sif <- readOutResult(cplexSolutionFileName = paste("results/",dir_name,"/results_cplex.txt",sep=""), variables = variables, pknList = pknList, conditionIDX = i,dir_name = dir_name, Export_all = Export_all,inputs=inputs,measurements=measurements)
}
} else {
print("No result to be written")
}
Elapsed_3 <- proc.time() - ptm
# Logged computational time
ElapsedAll <- as.data.frame(matrix(t(c(Elapsed_1[3],Elapsed_2[3],Elapsed_3[3])),3,1))
rownames(ElapsedAll) <- c("WriteConstraints:","CplexSolving:","ExportResults:")
write.table(x = ElapsedAll,file = paste("results/",dir_name,"/elapsed_time.txt",sep=""),col.names = F,row.names = T,quote = F)
}
}
